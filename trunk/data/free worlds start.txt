# Copyright (c) 2014 by Michael Zahniser
#
# Endless Sky is free software: you can redistribute it and/or modify it under the
# terms of the GNU General Public License as published by the Free Software
# Foundation, either version 3 of the License, or (at your option) any later version.
#
# Endless Sky is distributed in the hope that it will be useful, but WITHOUT ANY
# WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
# PARTICULAR PURPOSE.  See the GNU General Public License for more details.

mission "Liberate Kornephoros"
	description "Travel with the Free Worlds militia to the <system> system and drive off the Navy fleet that is occupying the system."
	source Longjump
	destination Deep
	clearance
	to offer
		has "Defend Sabik: done"
	
	on offer
		conversation
			`The mood in the spaceport is solemn. No one has had time yet to count up the losses, on both sides of the battle, but it is likely that over a thousand lives were lost. And because the Navy is held in such high regard even here where Parliament and the Paradise Planets are viewed with disgust, many of the militia captains are almost as saddened by the loss of Navy lives as by the loss of some of their own.`
			`	You find Tomek walking among the fleet, conversing with captains and assessing the damage they have suffered. When he sees you he says, "Captain <last>! How is your "<ship>" holding together?"`
			choice
				`	"She took a bit of a pounding, but I've patched her up."`
				`	"Just fine. It'd take more than a few cruisers to destroy the <ship>."`
			
			`	"Glad to hear it," he says. "Listen, we need to press our advantage before the Republic has time to call for reinforcements. If we strike quickly, we could be able to retake Kornephoros from them. It's important to break the blockade on that system just for the sake of trade with the rest of the galaxy, and on top of that, of course, Katya needs to be rescued."`
			`	"Indeed," you say.
			`	"We have a large fleet of reinforcements coming in from the Rim," he continues, "And a few ships here that are able to fight another battle. I need you to take off with them, wait for the reinforcements to arrive, and then retake Kornephoros. If the Navy ships retreat, let them retreat. If they surrender, let them surrender. But if they stay and fight, destroy them. Understood?"`
			choice
				`	"Yes, sir."`
					accept
				`	"I wish it hadn't come to this."`
			
			`	"We all do," he says. "No one wanted this. Not us, certainly not the Navy. But if they attack us to take our freedom, we must defend ourselves in order to keep it. Understood?"`
			`	"Yes, sir," you say. "I'll prepare my ship for another battle."`
				accept
		event "prepare for battle of Kornephoros"
	
	npc
		personality heroic
		government "Free Worlds"
		fleet "Small Free Worlds"
		fleet "Small Free Worlds"
		fleet "Large Free Worlds"
		fleet "Large Free Worlds"
	npc
		personality heroic
		government "Free Worlds"
		system Zubenelgenubi
		fleet "Small Free Worlds"
		fleet "Small Free Worlds"
		fleet "Small Free Worlds"
		fleet "Small Free Worlds"
		fleet "Large Free Worlds"
		fleet "Large Free Worlds"
		fleet "Large Free Worlds"
		fleet "Large Free Worlds"
	
	npc kill
		personality staying heroic
		government Republic
		system Kornephoros
		fleet "Small Republic"
		fleet "Small Republic"
		fleet "Small Republic"
		fleet "Small Republic"
		fleet "Large Republic"
		fleet "Large Republic"
		fleet "Large Republic"
	
	on visit
		dialog "There are still Navy ships patrolling overhead. Staying on <planet> while your allies are dying in orbit would be a very bad idea."
	
	on complete
		conversation
			`The last of the Navy vessels in orbit has been destroyed. As you land, you find that several Free Worlds troop transports have already set down in the spaceport and coralled the remaining Navy officers into a small circle. You would estimate that there are several hundred Navy prisoners. Another transport lands, carrying more prisoners: the Navy troops who had been guarding the mines on Clink.`
			`	For several hours, nothing changes: the Navy troops are huddled into a small circle, surrounded by guards. When lunchtime comes, some of the guards go to the market and fetch some of the vendors who sell meals out of carts there; they return with the carts and hand out food to the prisoners. Then, another transport lands and Tomek steps out.`
			`	He pulls you aside and asks you, "How are things going here?"`
			choice
				`	"Very quiet. They haven't given us any trouble."`
					goto quiet
				`	"The battle was brutal. I hope we don't have to keep doing that."`
					goto brutal
			
			label quiet
			`	"Glad to hear it," he says.`
				goto speech
			
			label brutal
			`	"I hope so too," he says. "Maybe we can make a start in that direction right now."`
				goto speech
			
			label speech
			`	Tomek climbs up onto the hull of a nearby ship and addresses the prisoners. "Hello," he says. A few of the Navy officers respond, warily. "My name is Tomek Voigt," he says. "Our militia is very loosely organized, but I'm the one in charge of organizing it." That gets a few laughs from the Free Worlds guards. "As such, I am resonsible for deciding your fate."`
			`	At that, a hush falls over the crowd. "The council has decided," he continues, "that any of you who gives us your parole, swearing to take no further part in fighting the Free Worlds, will be returned to Republic space. You will give us your word of honor that you will either seek reassignment in another part of the galaxy, or resign your commission."`
			`	A few of the Free Worlds guards shout, "What?" But only a surprising few. The rest are nodding, seemingly pleased with the council's choice. Tomek climbs down from the hull and approaches the prisoners, and you notice Alondo and Freya have joined him.`
			`	One of the Navy officers stands up. "I'll take that oath," he says, "if you'll honor your part of it."`
			`	Tomek takes the man's hands, looks him in the eyes, and asks, "Do you swear before God and these witnesses to take no further part in military actions against the Free Worlds?"`
			`	"I do," says the officer. Several of the other prisoners stand up, and before long all but a handful have sworn the oath.`
			`	After they finish, Tomek turns to you and a few other captains. "Emily, Marco, <first>, Sarah, please meet me in the spaceport cafe when you are ready." He walks off.`
		event "recapture of Kornephoros"



event "prepare for battle of Kornephoros"
	system "Kornephoros"
		fleet "Small Free Worlds" 1200
		fleet "Large Free Worlds" 1700



mission "FW Prisoner Parole"
	name "Prisoner Parole"
	description "Escort a fleet of transports carrying prisoners of war to <planet>. The temporary ceasefire will end on <date>."
	deadline 7
	source "Deep"
	destination "New Tibet"
	to offer
		has "Liberate Kornephoros: done"
	
	npc accompany save
		government "Escort"
		personality timid
		ship "Falcon" "R.N.S. Starry Warrior"
		ship "Blackbird" "Flight of Fancy"
		ship "Blackbird" "Southern Luxury"
	
	on offer
		conversation
			`When you have all gathered in the cafe, Tomek explains the situation to you. "Alondo has arranged for a one-week ceasefire to return the prisoners who have given us their parole," he says. "That gives you just enough time to transport them to New Tibet and return here. If you encounter Republic ships, do not engage them. Just drop off the prisoners and return. Any questions?"`
			choice
				`	"No, I'm ready to go."`
					accept
				`	"What should we do if they attack us?"`
			
			`	"If you can, return here without engaging them. No point is losing more lives."`
				accept
		"reputation: Republic" = 1
		event "temporary ceasefire"
		event "start of hostilities" 7
	
	on complete
		dialog `You drop off the Navy prisoners on <planet>. Now, it's time to get back to Deep with your fleet before the ceasefire ends.`



mission "FW Prisoner Parole 2"
	landing
	name "Prisoner Parole"
	description "Return to Deep before the cease-fire ends."
	source "New Tibet"
	destination "Deep"
	to offer
		has "FW Prisoner Parole: done"
	
	npc accompany save
		government "Escort"
		personality timid
		ship "Falcon" "R.N.S. Starry Warrior"
		ship "Blackbird" "Flight of Fancy"
		ship "Blackbird" "Southern Luxury"
	
	on complete
		conversation
			`Tomek seems very relieved to see you all back in one piece. "Thank you for your service," he says. "Please report to your local militia commanders for your next orders. Captain <last>, remain here."`
			`	After everyone else has left the room, he tells you, "I'm sorry, but I've got some bad news for you. We've searched the entire outpost on Clink. No sign of Katya. The miners don't know what happened to her, but I'd say it's a safe bet that she's either dead, or a prisoner."`
			choice
				`	"So, what do we do now?"`
					goto next
				`	"I wish we'd known that a few days earlier. We could have arranged a prisoner exchange."`
					goto exchange
			
			label exchange
			`	"I know," he says. "That's what a lot of our people are saying now. But what we did, a pure good-faith gesture with nothing demanded in return - we may come to be glad of that. My hope was to set a precedent, to shape the character of whatever conflict comes out of this, and I still think that was the right thing to do."`
			`	"So, what do we do now?" you ask.`
			
			label next
			`	"The Navy has had two crushing defeats," he says. "They will be hesitant to attack again until their numbers are much stronger. That gives us some time for diplomacy, to strengthen our position and look for allies, or at least for sympathizers. Which is where you come in. I'm going to ask you to carry a diplomatic mission to the Syndicate. Meet us in the spaceport when you are ready."`
		"reputation: Republic" = -100
